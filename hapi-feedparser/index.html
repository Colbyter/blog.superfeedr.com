<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="google-site-verification" content="ofroHQ3qXBS1SQfblK9-U_oduGZ975Bb3i_uP13Myao" />

  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,400italic|Source+Code+Pro:400,600' rel='stylesheet' type='text/css'>

  <link href="/css/front.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/css/prism.css" rel="stylesheet" type="text/css">

  <title>Superfeedr : Superfeedr, Hapi & Feedparser </title>

  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml">
  <link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />

  <meta http-equiv="Content-Security-Policy" content="connect-src stream.superfeedr.com">

  <link rel="shortcut icon" href="/favicon.png">

</head>
<body>
  <header class="header">
    <div class="container">
      <h1 class="header-logo"><a href="/"><img src="/images/logo.png" alt=""> <span>Superfeedr Blog</span></a></h1>
      <nav class="nav-header">
        <ul class="nav-items">
          <li class="nav-item"><a href="http://superfeedr.com/about" class="nav-link">About</a></li>
          <li class="nav-item"><a href="http://superfeedr.com/publisher" class="nav-link">Publishers</a></li>
          <li class="nav-item"><a href="http://superfeedr.com/subscriber" class="nav-link">Subscribers</a></li>
          <li class="nav-item"><a href="http://superfeedr.com/subscriber/pricing" class="nav-link">Pricing</a></li>
          <li class="nav-item"><a href="http://superfeedr.com/login" class="nav-link nav-link-bubble">Login</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container body">
    <header class="body-header">
      <div class="blog-links">
        <input type="button" class="button  button--raised  button--positive" value="Subscribe" onclick="(function(){var z=document.createElement('script');z.src='http://www.subtome.com/load.js';document.body.appendChild(z);})()">
        <a href="/archive.html" class="button  button--raised  button--neutral">Read Archives</a>
      </div>
      <h2><strong>Blog</strong></h2>
    </header>

    <div class="body-content">
      <section class="column  column--terms  body-content-text">
        <article class="blog-article blog-article--single h-entry">
  <h3 class="entry-title p-name"><a class="u-url" href="/hapi-feedparser">Superfeedr, Hapi & Feedparser</a></h3>

  <span class="invisible u-uid" style="display:none">blog.superfeedr.com:/hapi-feedparser</span>

  <div class="entry-meta">
    <ul class="entry-meta--primary postmeta">
      <li class="entry-meta--item">By <span class="p-author h-card"><img class="u-photo" src="http://www.gravatar.com/avatar/b30ce50678f0e934eaa6697425c59dd7?s=20" > <a href="http://ouvre-boite.com" rel="author">Julien</a></span></li>
      <li class="entry-meta--item dt-published" datetime="2014-08-08T00:00:00+02:00"><time>08 Aug 2014</time></li>
    </ul>
  </div>
  <div class="entry-content e-content">
    <p>The last couple weeks have been busy with the <a href="http://blog.superfeedr.com/survey-redesign/">redesign</a>. We had to update our venerable Rails 2.3.X app and move to a new Ruby2.0 + Rails 3.2 stack, with Rails 4.0 right around the corner.</p>

<p>However, to keep our sanity, we also worked on a bunch of side project, with Node. </p>

<h3 id="hapi-superfeedr">Hapi-Superfeedr</h3>

<p><a href="https://github.com/senchalabs/connect#readme">Connect</a> and <a href="http://expressjs.com/">Express</a> have long been everyone’s favorite HTTP server framework in Node. The last couple months have seen the introduction and growth of a challenger: <a href="http://hapijs.com/">Hapi</a>! It took us some time, but this week, we dived into it with the goal of <em>making a Superfeedr plugin</em> for it.</p>

<p>At first, Hapi’s words have been a bit rough to understand: what’s the difference between a <strong>pack</strong> a <strong>server</strong> and a <strong>plugin</strong>? But it quickly starts to shine through the expressiveness of the API. a
Making the plugin was eventually quite easy. </p>

<p>A plugin is nothing more than a <strong>node module</strong> with a <code>register</code> method and a couple registration attributes (name, version…). The register method allows the implementer <em>define routes</em> specific to the plugin, as well as define what’s <em>explictly exposed</em> to the plugin user. If you’re interested in the process, feel free to read <a href="https://github.com/hapijs/discuss/issues/1">this issue</a> which shows what questions we asked ourselves and what where the answers provided by the Hapi community.</p>

<p>In the end, the <a href="https://github.com/superfeedr/superfeedr-hapi">Superfeedr Hapi plugin</a> is very simple: half of the code is used to create a function that sends POST requests to Superfeedr and is not hapi-speficic.</p>

<p>If you’re interested in using it, please check <a href="https://github.com/superfeedr/superfeedr-hapi">this README</a>.</p>

<h3 id="node-feedparser">Node-Feedparser</h3>

<p>I met with <a href="http://yabfog.com/blog/">Dan</a> at <a href="https://github.com/Reboot-RSS/reboot-rss">Reboot RSS</a> and then I promised myself I’d give a shot at his <a href="https://github.com/danmactough/node-feedparser">Node-feedparser library</a>. It’s a lirary to handle the parsing of a feed using Node. It does not do diffing, it does not do fetching or scheduling, it just does parsing and it does it very well! As a consequence, it’s <em>very simple to integrate with Superfeedr</em>.</p>

<p>The Superfeedr-hapi plugin does not do parsing. It will just issue subscriptions and receive data (through webhooks). It becomes then easy to plug node-feedparser like that:</p>

<pre data-line=""><code class="language-javascript">server.plugins.superfeedr.events.on(&#39;notification&#39;, function(feed_id, payload, url, request) {
  feedparser = new FeedParser({feedurl: url});
  feedparser.write(payload);
  feedparser.on(&#39;data&#39;, function(data) {
    fs.appendFile(&#39;river.html&#39;, Mustache.render(&#39;&lt;li&gt;&lt;a href=&quot;&quot;&gt;&lt;&gt;&lt;/a&gt;  - &lt;a href=&quot;&quot;&gt;&lt;/a&gt;&lt;/li&gt;\n&#39;, data));
  });
});</code></pre>

<p>Each time a new event is sent from Superfeedr, a feedparser instance parses that data and triggers the <code>data</code> event for every entry, it then saves them to a <code>river.html</code> file.</p>

<p>Node-feedparser does some <em>normalization</em> by default, which means that if you use it in your existing feed project and want to switch to Superfeedr for fetching, diffing and scheduling, you will not have any data model change. <em>Little bits of code working together</em> is one of Node’s most important cultures!</p>


  </div>
</article>
<div class="blog-more">
  Liked this post? <a href="/archive.html">Read the archive</a> or <input type="button" value="Subscribe" class="button  button--raised  button--positive" onclick="(function(){var z=document.createElement('script');z.src='http://www.subtome.com/load.js';document.body.appendChild(z);})()">
</div>
<div class="blog-comments">
  <h3>Comments</h3>

    <div id="disqus_thread">
    </div>

    <script type="text/javascript" src="https://disqus.com/forums/superfeedr-thoughts/embed.js"></script>
    <noscript>
        <a href="https://superfeedr-thoughts.disqus.com/?url=ref">View the discussion thread.</a>
    </noscript>

    <script id="webmention-hosted">
    (function () {
      var sn = document.createElement("script"), s = document.getElementsByTagName("script")[0], url;
      url = document.querySelectorAll ? document.querySelectorAll("link[rel~=canonical]") : false;
      url = url && url[0] ? url[0].href : false;
      sn.type = "text/javascript"; sn.async = true;
      sn.src = "//webmention.herokuapp.com/api/embed?url=" + encodeURIComponent(url || window.location);
      s.parentNode.insertBefore(sn, s);
    }());
    </script>
</div>

      </section>
    </div>

  </main>

  <div class="footer container">
    <footer class="site-footer">
      <ul class="site-footer__list">
<!--         <li class="site-footer__item"><a href="" class="site-footer__link">Documentation</a></li>
        <li class="site-footer__item"><a href="" class="site-footer__link">Support</a></li>
        <li class="site-footer__item"><a href="" class="site-footer__link">Blog</a></li>
        <li class="site-footer__item"><a href="/pricing.html" class="site-footer__link">Pricing</a></li>
        <li class="site-footer__item"><a href="" class="site-footer__link">Terms</a></li>
 -->      </ul>
      <ul class="site-footer__meta">
        <p class="site-footer__copyright">&copy; 2009&ndash;2014 Superfeedr</p>
      </ul>
    </footer>
  </div>



  


  <script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script>
  <script type="text/javascript">
  <!--//--><![CDATA[//><!--
  try {
    var pageTracker = _gat._getTracker('UA-9285763-1');
    pageTracker._setDomainName("superfeedr.com");
    pageTracker._initData();
    pageTracker._trackPageview();
  } catch(err) {}
  //--><!]]>
  </script>

  <script src="/scripts/prism.js"></script>

</body>
</html>



